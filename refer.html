<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Refer Dashboard</title>
<style>
body {
    margin:0;
    font-family:sans-serif;
    background: linear-gradient(to right, rgb(55,194,115), rgb(183,226,196));
}
header { text-align:center; padding:30px 20px; }
main { padding:20px; max-width:1200px; margin:auto; }
a.back { display:inline-block; margin-bottom:20px; color:navy; text-decoration:none; font-weight:bold; }
.select-table { margin:20px 0; padding:10px; font-size:16px; }

/* Grid สำหรับตาราง */
.tables-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 20px;
}

/* Card สำหรับแต่ละตาราง */
.table-card {
    background-color: rgba(255,255,255,0.95);
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow-x: auto;
}
.table-card h2 { text-align:center; margin-top:0; }

/* ตารางทั่วไป */
table { width:100%; border-collapse: collapse; }
th, td { padding: 12px; text-align:center; border-bottom:1px solid #ddd; transition: background 0.3s, transform 0.2s; }
th { background: linear-gradient(90deg, #4a90e2, #50e3c2); color:#fff; text-transform: uppercase; }
tr:hover { background-color: rgba(79,209,197,0.15); transform: scale(1.01); }
tfoot td { font-weight: bold; background: linear-gradient(90deg, #1a365d, #2b6cb0); color: #fff; }

/* Zebra stripe */
table tr:nth-child(even) { background-color: rgba(0,0,0,0.05); }
table tr:nth-child(odd) { background-color: rgba(0,0,0,0.02); }

/* ไฮไลท์คอลัมน์ รพ. */
table td.rp-column { font-weight:bold; font-size:16px; color:#1a365d; text-align:left; }

@media (max-width:600px){ th, td{ padding:8px; font-size:14px; } }
</style>
</head>
<body>
<header>
    <h1>Refer Dashboard</h1>
</header>
<main>
<a href="index.html" class="back">&larr; กลับหน้าหลัก</a>

<label for="tableSelect">เลือกตาราง:</label>
<select id="tableSelect" class="select-table">
    <option value="referOut">Refer Out</option>
    <option value="referInBack">Refer In Refer Back</option>
    <option value="top10OutOPD">10 อันดับ Refer Out ผู้ป่วยนอก</option>
    <option value="top10OutIPD">10 อันดับ Refer Out ผู้ป่วยใน</option>
    <option value="top10InBack">10 อันดับ Refer In+Back</option>
    <option value="top10InNode">10 อันดับ Refer In Node</option>
    <option value="referInHospBranch">Refer In ลูกข่ายแยกสาขา</option>
</select>

<div class="tables-grid">
    <div id="referOut" class="table-card"><h2>Refer Out</h2><table><thead></thead><tbody></tbody></table></div>
    <div id="referInBack" class="table-card" style="display:none;"><h2>Refer In Refer Back</h2><table><thead></thead><tbody></tbody></table></div>
    <div id="top10OutOPD" class="table-card" style="display:none;"><h2>10 อันดับ Refer Out ผู้ป่วยนอก</h2><table><thead></thead><tbody></tbody></table></div>
    <div id="top10OutIPD" class="table-card" style="display:none;"><h2>10 อันดับ Refer Out ผู้ป่วยใน</h2><table><thead></thead><tbody></tbody></table></div>
    <div id="top10InBack" class="table-card" style="display:none;"><h2>10 อันดับ Refer In+Back</h2><table><thead></thead><tbody></tbody></table></div>
    <div id="top10InNode" class="table-card" style="display:none;"><h2>10 อันดับ Refer In Node</h2><table><thead></thead><tbody></tbody></table></div>
    <div id="referInHospBranch" class="table-card" style="display:none;"><h2>Refer In ลูกข่ายแยกสาขา</h2><table><thead></thead><tbody></tbody></table></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const sheetLinks = {
    referOut: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR1eN1MEqpkd7w5WLILIpUSIglAUMtWb8vPWL8YdQu-rtaK9QsAgCqQ3VR8ECtbKQyYt5Ujc5wtgPuA/pub?output=csv",
    referInBack: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS845waYv-Ws4EvTQvUbARDYxs64HKhN1d_BFv36_wrmRY5nTJQrLKiMLQW8fEVDLFadUvQdqakhW0i/pub?output=csv",
    top10OutOPD: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRMUE4kT1n9oZWCX99oSUuFwfA-3zfOB9IdxrQ612GJSEp_nDBP9gbehZq2nFyk2dXNC0SLa4FWJ2db/pub?output=csv",
    top10OutIPD: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSweVDQKy-fl0Hy0CK1ogoNtQrJGbM0BT_a2IkM-l2LNhlrGFpzSPrdyadm0B2gqk1W0Qq4E3cfeqfm/pub?output=csv",
    top10InBack: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsMJjDJikonT4uOqn_l6xmsY9Mvfkcy1YWNHj2ihd7MtNhsHj9dgCW3OI2NOW7UjPKKjB8S4d9rsrw/pub?output=csv",
    top10InNode: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSi7XoxLmlLH6Oj_ZDqANsf6Do7svF1iRmJ9eQeAyvPRZtOTf3bEoPFZx9c2_dMmas0ojBu8v5SKJss/pub?output=csv",
    referInHospBranch: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRGINKGg7UiFst0q7vm5X1wLBl3gzSApQ5Izh2BC8dvwCjs8yrjrrNjIvEJxGBzMsrKlcyKm6_uH1vA/pub?output=csv"
};

async function loadTableWithRpHighlight(tableId) {
    const url = sheetLinks[tableId];
    if(!url) return;
    const res = await fetch(url);
    const text = await res.text();
    const data = Papa.parse(text.trim(), { header: true }).data;

    const tableDiv = document.getElementById(tableId);
    const table = tableDiv.querySelector("table");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");
    if(!data.length) return;

    const headers = Object.keys(data[0]);
    thead.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";

    tbody.innerHTML = data.map(row => {
        return "<tr>" + headers.map(h => {
            if(h === "รพ.") return `<td class="rp-column">${row[h] || ""}</td>`;
            return `<td>${row[h] || ""}</td>`;
        }).join("") + "</tr>";
    }).join("");
}

// โหลดทุกตาราง
Object.keys(sheetLinks).forEach(id => loadTableWithRpHighlight(id));

// Dropdown
const select = document.getElementById("tableSelect");
const tables = document.querySelectorAll(".table-card");
select.addEventListener("change", function() {
    tables.forEach(t => t.style.display = "none");
    const selected = document.getElementById(this.value);
    if(selected) selected.style.display = "block";
});
// แสดงเริ่มต้น
tables.forEach(t => t.style.display = "none");
document.getElementById(select.value).style.display = "block";
</script>
</main>
</body>
</html>
